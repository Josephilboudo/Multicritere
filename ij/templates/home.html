{%load static%}
{% load custom_tags %}

<!DOCTYPE html>
<html lang="en">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">

<!-- DataTables JS -->
<script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
{%include 'head.html'%}
<body>
  <div class="container-scroller">
    {%include 'nav.html'%}
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_settings-panel.html -->
      <div class="theme-setting-wrapper">
        <div id="settings-trigger"><i class="ti-settings"></i></div>
        <div id="theme-settings" class="settings-panel">
          <i class="settings-close ti-close"></i>
          <p class="settings-heading">SIDEBAR SKINS</p>
          <div class="sidebar-bg-options selected" id="sidebar-light-theme"><div class="img-ss rounded-circle bg-light border mr-3"></div>Light</div>
          <div class="sidebar-bg-options" id="sidebar-dark-theme"><div class="img-ss rounded-circle bg-dark border mr-3"></div>Dark</div>
          <p class="settings-heading mt-2">HEADER SKINS</p>
          <div class="color-tiles mx-0 px-4">
            <div class="tiles success"></div>
            <div class="tiles warning"></div>
            <div class="tiles danger"></div>
            <div class="tiles info"></div>
            <div class="tiles dark"></div>
            <div class="tiles default"></div>
          </div>
        </div>
      </div>
      <div id="right-sidebar" class="settings-panel">
        <i class="settings-close ti-close"></i>
        <ul class="nav nav-tabs border-top" id="setting-panel" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="todo-tab" data-toggle="tab" href="#todo-section" role="tab" aria-controls="todo-section" aria-expanded="true">TO DO LIST</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="chats-tab" data-toggle="tab" href="#chats-section" role="tab" aria-controls="chats-section">CHATS</a>
          </li>
        </ul>
        <div class="tab-content" id="setting-content">
          <div class="tab-pane fade show active scroll-wrapper" id="todo-section" role="tabpanel" aria-labelledby="todo-section">
            <div class="add-items d-flex px-3 mb-0">
              <form class="form w-100">
                <div class="form-group d-flex">
                  <input type="text" class="form-control todo-list-input" placeholder="Add To-do">
                  <button type="submit" class="add btn btn-primary todo-list-add-btn" id="add-task">Add</button>
                </div>
              </form>
            </div>
            <div class="list-wrapper px-3">
              <ul class="d-flex flex-column-reverse todo-list">
                <li>
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="checkbox" type="checkbox">
                      Team review meeting at 3.00 PM
                    </label>
                  </div>
                  <i class="remove ti-close"></i>
                </li>
                <li>
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="checkbox" type="checkbox">
                      Prepare for presentation
                    </label>
                  </div>
                  <i class="remove ti-close"></i>
                </li>
                <li>
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="checkbox" type="checkbox">
                      Resolve all the low priority tickets due today
                    </label>
                  </div>
                  <i class="remove ti-close"></i>
                </li>
                <li class="completed">
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="checkbox" type="checkbox" checked>
                      Schedule meeting for next week
                    </label>
                  </div>
                  <i class="remove ti-close"></i>
                </li>
                <li class="completed">
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="checkbox" type="checkbox" checked>
                      Project review
                    </label>
                  </div>
                  <i class="remove ti-close"></i>
                </li>
              </ul>
            </div>
            <h4 class="px-3 text-muted mt-5 font-weight-light mb-0">Events</h4>
            <div class="events pt-4 px-3">
              <div class="wrapper d-flex mb-2">
                <i class="ti-control-record text-primary mr-2"></i>
                <span>Feb 11 2018</span>
              </div>
              <p class="mb-0 font-weight-thin text-gray">Creating component page build a js</p>
              <p class="text-gray mb-0">The total number of sessions</p>
            </div>
            <div class="events pt-4 px-3">
              <div class="wrapper d-flex mb-2">
                <i class="ti-control-record text-primary mr-2"></i>
                <span>Feb 7 2018</span>
              </div>
              <p class="mb-0 font-weight-thin text-gray">Meeting with Alisa</p>
              <p class="text-gray mb-0 ">Call Sarah Graves</p>
            </div>
          </div>
          <!-- To do section tab ends -->
          <div class="tab-pane fade" id="chats-section" role="tabpanel" aria-labelledby="chats-section">
            <div class="d-flex align-items-center justify-content-between border-bottom">
              <p class="settings-heading border-top-0 mb-3 pl-3 pt-0 border-bottom-0 pb-0">Friends</p>
              <small class="settings-heading border-top-0 mb-3 pt-0 border-bottom-0 pb-0 pr-3 font-weight-normal">See All</small>
            </div>
            <ul class="chat-list">
              <li class="list active">
                <div class="profile"><img src="{% static 'images/faces/face1.jpg' %}" alt="image"><span class="online"></span></div>
                <div class="info">
                  <p>Thomas Douglas</p>
                  <p>Available</p>
                </div>
                <small class="text-muted my-auto">19 min</small>
              </li>
              <li class="list">
                <div class="profile"><img src="{% static 'images/faces/face2.jpg' %}" alt="image"><span class="offline"></span></div>
                <div class="info">
                  <div class="wrapper d-flex">
                    <p>Catherine</p>
                  </div>
                  <p>Away</p>
                </div>
                <div class="badge badge-success badge-pill my-auto mx-2">4</div>
                <small class="text-muted my-auto">23 min</small>
              </li>
              <li class="list">
                <div class="profile"><img src="{% static 'images/faces/face3.jpg' %}" alt="image"><span class="online"></span></div>
                <div class="info">
                  <p>Daniel Russell</p>
                  <p>Available</p>
                </div>
                <small class="text-muted my-auto">14 min</small>
              </li>
              <li class="list">
                <div class="profile"><img src="{% static 'images/faces/face4.jpg' %}" alt="image"><span class="offline"></span></div>
                <div class="info">
                  <p>James Richardson</p>
                  <p>Away</p>
                </div>
                <small class="text-muted my-auto">2 min</small>
              </li>
              <li class="list">
                <div class="profile"><img src="images/faces/face5.jpg" alt="image"><span class="online"></span></div>
                <div class="info">
                  <p>Madeline Kennedy</p>
                  <p>Available</p>
                </div>
                <small class="text-muted my-auto">5 min</small>
              </li>
              <li class="list">
                <div class="profile"><img src="{% static 'images/faces/face6.jpg' %}" alt="image"><span class="online"></span></div>
                <div class="info">
                  <p>Sarah Graves</p>
                  <p>Available</p>
                </div>
                <small class="text-muted my-auto">47 min</small>
              </li>
            </ul>
          </div>
          <!-- chat tab ends -->
        </div>
      </div>
      <!-- partial -->
      <!-- partial:partials/_sidebar.html -->
      {%include 'sidebar.html'%}
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row">
            <div class="col-md-12 grid-margin">
              <div class="row">
                <div class="col-12 col-xl-8 mb-4 mb-xl-0">
                  <h3 class="font-weight-bold">Welcome Joseph</h3>
                  <h6 class="font-weight-normal mb-0">All systems are running smoothly! You have <span class="text-primary">3 unread alerts!</span></h6>
                </div>
                <!-- Bouton vert pour connexion a la BD -->
                <div class="d-flex justify-content-end">
                  <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#connectDatabaseModal">
                      <i class="fas fa-database"></i>
                  </button>
              </div>
</div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 grid-margin stretch-card">
                  <canvas id="performanceChart"></canvas>
            </div>
            <div class="col-md-6 grid-margin transparent">
              <div class="row">
                <div class="col-md-6 mb-4 stretch-card transparent">
                  <div class="card card-tale">
                    <div class="card-body">
                      <p class="mb-4">Total Elements</p>
                      <p class="fs-30 mb-2">{{ total_elements }}</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 mb-4 stretch-card transparent">
                  <div class="card card-dark-blue">
                    <div class="card-body">
                      <p class="mb-4">Total Ressources</p>
                      <p class="fs-30 mb-2">{{ total_ressources }}</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-4 mb-lg-0 stretch-card transparent">
                  <div class="card card-light-blue">
                    <div class="card-body">
                      <p class="mb-4">Total Criteres</p>
                      <p class="fs-30 mb-2">{{ total_criteres }}</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 stretch-card transparent">
                  <div class="card card-light-danger">
                    <div class="card-body">
                      <p class="mb-4">Total Contraintes</p>
                      <p class="fs-30 mb-2">{{ total_contraintes }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
        
            
            <div class="row">
              <div class="col-md-12 grid-margin stretch-card">
                  <div class="card">
                      <div class="card-body">
                          <p class="card-title">Liste des Solutions</p>
                          <div class="row">
                              <div class="col-12">
                                  <div class="table-responsive">
                                      <table id="example" class="display expandable-table" style="width:100%">
                                          <thead>
                                              <tr>
                                                  <th>ID Solution</th>
                                                  <th>Statut</th>
                                                  {% for nom in noms_objectifs %}
                                                      <th>{{ nom }}</th>
                                                  {% endfor %}
                                                  <th>Action</th>
                                              </tr>
                                          </thead>
                                          <tbody>
                                              {% for solution_obj in solutions_objectifs %}
                                              <tr>
                                                  <td>{{ solution_obj.id }}</td>
                                                  <td>{{ solution_obj.statut }}</td>
                                                  {% for nom in noms_objectifs %}
                                                      <td>{{ solution_obj.objectifs|get_item:nom }}</td>
                                                  {% endfor %}
                                                  <td>
                                                  <button class="btn btn-primary" onclick="openModal({{ solution_obj.id }})">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                  <button class="btn btn-success btn-sm" onclick="#">
                                                      <i class="fas fa-check"></i> <!-- Icône de validation -->
                                                  </button>
                                                  </td>
                                              </tr>
                                              {% endfor %}
                                          </tbody>
                                      </table>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>

          <!-- MODAL Solution -->
          <!-- Modal -->
<div class="modal fade" id="solutionModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">Détails de la Solution</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <p><strong>ID :</strong> <span id="solution-id"></span></p>
              <p><strong>Statut :</strong> <span id="solution-statut"></span></p>

              <h6>Tableau des Données</h6>
              <table class="table table-bordered" id="solution-table">
                  <thead></thead>
                  <tbody></tbody>
              </table>
          </div>
          <div class="modal-footer">
            <a id="downloadPdfBtn" href="#" class="btn btn-primary"><i class="fas fa-download"></i></a>
          </div>
      </div>
  </div>
</div>

        
          
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">ESI © 2025.</span>
          </div>
        </footer> 
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>   
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- plugins:js -->
  <script src="{% static 'vendors/js/vendor.bundle.base.js' %}"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="{% static 'vendors/chart.js/Chart.min.js' %}"></script>
  <script src="{% static 'vendors/datatables.net/jquery.dataTables.js' %}"></script>
  <script src="{% static 'vendors/datatables.net-bs4/dataTables.bootstrap4.js' %}"></script>
  <script src="{% static 'js/dataTables.select.min.js' %}"></script>

  <!-- End plugin js for this page -->
  <!-- inject:js -->

  <script src="{% static 'js/off-canvas.js' %}"></script>
  <script src="{% static 'js/hoverable-collapse.js' %}"></script>
  <script src="{% static 'js/template.js' %}"></script>
  <script src="{% static 'js/settings.js' %}"></script>
  <script src="{% static 'js/todolist.js' %}"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="{% static 'js/dashboard.js' %}"></script>
  <script src="{% static 'js/Chart.roundedBarCharts.js' %}"></script>
  <!-- End custom js for this page-->
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Modal Bootstrap -->
<!-- Modal pour la connexion à la base de données -->
<div class="modal fade" id="connectDatabaseModal" tabindex="-1" aria-labelledby="connectDatabaseModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="connectDatabaseModalLabel">Connexion à la base de données</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="connectDatabaseForm">
          <div class="mb-3">
            <label for="dbName" class="form-label">Nom de la base de données</label>
            <input type="text" class="form-control" id="dbName" name="dbName" required>
          </div>
          <div class="mb-3">
            <label for="dbUser" class="form-label">Utilisateur</label>
            <input type="text" class="form-control" id="dbUser" name="dbUser" required>
          </div>
          <div class="mb-3">
            <label for="dbPassword" class="form-label">Mot de passe</label>
            <input type="password" class="form-control" id="dbPassword" name="dbPassword" required>
          </div>
          <div class="mb-3">
            <label for="dbHost" class="form-label">Hôte</label>
            <input type="text" class="form-control" id="dbHost" name="dbHost" required>
          </div>
          <div class="mb-3">
            <label for="dbPort" class="form-label">Port</label>
            <input type="text" class="form-control" id="dbPort" name="dbPort" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-primary" id="connectDatabaseButton">Se connecter</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Bootstrap (Masqué au départ) -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1050;">
  <!-- Toast pour les erreurs -->
  <div id="errorToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header bg-danger text-white">
        <strong class="me-auto">Erreur</strong>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
        <!-- Le message d'erreur sera inséré ici -->
    </div>
  </div>
  <!-- Toast pour les succès -->
  <div id="successToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header bg-success text-white">
        <strong class="me-auto">Succès</strong>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
        <!-- Le message de succès sera inséré ici -->
    </div>
  </div>

<!-- jQuery et AJAX -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  $(document).ready(function () {
    $("#dbForm").submit(function (event) {
        event.preventDefault();  // Empêche le rechargement de la page

        var formData = {
            database_name: $("#database_name").val(),
            user: $("#user").val(),
            password: $("#password").val(),
            csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
        };

        $.ajax({
            type: "POST",
            url: "{% url 'connect_database' %}",  
            data: formData,
            dataType: "json",
            success: function (response) {
                if (response.status === "success") {
                    $("#successMessage").text(response.message);
                    var successToast = new bootstrap.Toast(document.getElementById("successToast"));
                    successToast.show();
                    $("#dbModal").modal("hide"); // Ferme le modal après connexion

                    // Fermer complètement le modal
                    var modal = bootstrap.Modal.getInstance(document.getElementById("dbModal"));
                    if (modal) {
                        modal.dispose();
                    }

                    // Supprimer manuellement le backdrop et la classe "modal-open"
                    $(".modal-backdrop").remove();
                    $("body").removeClass("modal-open");

                } else {
                    $("#errorMessage").text(response.message);
                    var errorToast = new bootstrap.Toast(document.getElementById("errorToast"));
                    errorToast.show();
                }
            },
            error: function () {
                $("#errorMessage").text("Une erreur s'est produite !");
                var errorToast = new bootstrap.Toast(document.getElementById("errorToast"));
                errorToast.show();
            }
        });
    });

    // Vérifier si Bootstrap et jQuery sont chargés
    if (typeof $ === "undefined" || typeof $.fn.modal === "undefined") {
      console.error("jQuery ou Bootstrap Modal non chargé !");
      return;
  }

  // Fermer le modal en cliquant sur le bouton
  $("#closeModalButton").click(function () {
      $("#solutionModal").modal("hide");
  });

  // Fermer le modal en cliquant sur la croix
  $(".close").click(function () {
      $("#solutionModal").modal("hide");
  });
});

</script>
<!--script pour connexion  la base de donnees-->
<!--script pour importation depuis dase de donnees-->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const connectButton = document.getElementById('connectDatabaseButton');

    // Replace your existing forceCloseModal function with this one
function forceCloseModal(modalId) {
  // Close the modal using Bootstrap API
  const modalElement = document.getElementById(modalId);
  const modalInstance = $(modalElement).data('bs.modal');

  
  if (modalInstance) {
      modalInstance.hide();
  }
  
  // Give a small delay to allow Bootstrap to start its hiding process
  setTimeout(() => {
      // Force remove the backdrop
      const backdrops = document.querySelectorAll('.modal-backdrop');
      backdrops.forEach(backdrop => backdrop.remove());
      
      // Reset body classes and styles
      document.body.classList.remove('modal-open');
      document.body.style.removeProperty('padding-right');
      document.body.style.removeProperty('overflow');
  }, 150);
}
    // Gestion du bouton de connexion
    if (connectButton) {
        connectButton.addEventListener('click', async function () {
            const dbName = document.getElementById('dbName').value;
            const dbUser = document.getElementById('dbUser').value;
            const dbPassword = document.getElementById('dbPassword').value;
            const dbHost = document.getElementById('dbHost').value;
            const dbPort = document.getElementById('dbPort').value;

            try {
                // Établir la connexion
                const connectionResponse = await fetch("{% url 'connect_to_external_db' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        dbName: dbName,
                        dbUser: dbUser,
                        dbPassword: dbPassword,
                        dbHost: dbHost,
                        dbPort: dbPort
                    }),
                });

                const connectionData = await connectionResponse.json();
                if (connectionData.status === 'success') {
                    showSuccessToast("Connexion réussie !");

                    // Fermer le modal de connexion
                    forceCloseModal('connectDatabaseModal');
                } else {
                    showErrorToast("Erreur : " + connectionData.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                showErrorToast("Une erreur est survenue lors de la connexion.");
            }
        });
    }

    // Fonction pour afficher un toast de succès
    function showSuccessToast(message) {
        const successToast = document.getElementById('successToast');
        const toastBody = successToast.querySelector('.toast-body');
        toastBody.textContent = message;

        const toast = new bootstrap.Toast(successToast, {
          delay: 8000 });
        toast.show();
    }

    // Fonction pour afficher un toast d'erreur
    function showErrorToast(message) {
        const errorToast = document.getElementById('errorToast');
        const toastBody = errorToast.querySelector('.toast-body');
        toastBody.textContent = message;

        const toast = new bootstrap.Toast(errorToast);
        toast.show();
    }

    // Fonction pour récupérer le token CSRF
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});

//fonction pour le modal consulter Solution
function openModal(solutionId) {
  console.log("Chargement des détails pour la solution :", solutionId);

  $.ajax({
      url: `/solution-details/${solutionId}/`,
      type: 'GET',
      success: function(response) {
          $("#solution-id").text(response.id);
          $("#solution-statut").text(response.statut);

          // Générer dynamiquement les colonnes
          let data = response.data;
          let columns = new Set();

          data.forEach(row => {
              Object.keys(row).forEach(key => {
                  if (key !== "element" && key !== "ressource") {
                      columns.add(key);
                  }
              });
          });

          // Construire l'en-tête du tableau
          let tableHead = `<tr>
              <th>Élément</th>
              <th>Ressource</th>`;
          columns.forEach(col => {
              tableHead += `<th>${col}</th>`;
          });
          tableHead += `</tr>`;
          $("#solution-table thead").html(tableHead);

          // Construire le corps du tableau
          let tableBody = "";
          data.forEach(row => {
              tableBody += `<tr>
                  <td>${row.element}</td>
                  <td>${row.ressource}</td>`;
              columns.forEach(col => {
                  tableBody += `<td>${row[col] !== null ? row[col] : '-'}</td>`;
              });
              tableBody += `</tr>`;
          });
          $("#solution-table tbody").html(tableBody);

          // Mettre à jour l'URL du bouton "Télécharger en PDF"
        $("#downloadPdfBtn").attr("href", `/solution-pdf/${solutionId}/`);

          // Afficher le modal
          $("#solutionModal").modal("show");
      },
      error: function(xhr) {
          console.error("Erreur lors du chargement :", xhr.responseText);
          alert("Impossible de charger les détails !");
      }
  });
}
</script>
<!--pour le graphe-->
      <script>
        async function fetchData() {
          const response = await fetch('/graph-solutions-data/');
          const data = await response.json();
      
          console.log("Données reçues :", data); // Debugging
      
          if (!data.solutions || data.solutions.length === 0) {
              console.error("Aucune solution disponible !");
              return;
          }
      
          // Extraire les noms des objectifs (compétence, charge Travaille)
          const labels = Object.keys(data.solutions[0].objectifs);  
      
          // Construire les datasets
          const datasets = data.solutions.map((solution, index) => ({
              label: `Solution ${solution.id}`,
              data: labels.map(obj => solution.objectifs[obj]), // Récupère les valeurs des objectifs
              backgroundColor: `rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.6)`
          }));
      
          // Affichage du graphique
          const ctx = document.getElementById('performanceChart').getContext('2d');
          new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: labels,  // ["compétence", "charge Travaille"]
                  datasets: datasets
              },
              options: {
                  responsive: true,
                  scales: {
                      y: { beginAtZero: false }  // Permet les valeurs négatives
                  },
                  plugins: {
                      legend: { position: 'top' },
                      title: { display: true, text: 'Comparaison des solutions' }
                  }
              }
          });
      }
      
      // Appel de la fonction pour charger les données et afficher le graphique
      fetchData();
             
    </script>
</body>

</html>